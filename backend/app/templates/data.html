{% extends "base.html" %}
{% block content %}
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h2 class="h5 mb-1">数据库浏览与操作</h2>
      <p class="text-muted small mb-0">选择任意数据库查看实时数据，直接在页面新增/更新商品以触发三库联动。</p>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary btn-sm" href="/ui/query">复杂查询示例</a>
      <button class="btn btn-primary btn-sm" id="refresh-btn" type="button">刷新数据</button>
    </div>
  </div>

  <div class="card card-dashboard mb-4">
    <div class="card-body">
      <div class="row g-3 align-items-end">
        <div class="col-md-3">
          <label class="form-label">目标数据库</label>
          <select class="form-select" id="db-select">
            <option value="mysql">MySQL</option>
            <option value="postgres">PostgreSQL</option>
            <option value="mssql">SQL Server</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">商品 ID（留空自动生成）</label>
          <input class="form-control" id="product-id" placeholder="点击下方表格可自动填充">
        </div>
        <div class="col-md-3">
          <label class="form-label">商品名称</label>
          <input class="form-control" id="product-name" placeholder="例如 数据同步网关">
        </div>
        <div class="col-md-2">
          <label class="form-label">价格（¥）</label>
          <input class="form-control" id="product-price" type="number" step="0.01" min="0" placeholder="199.00">
        </div>
        <div class="col-md-1">
          <label class="form-label">库存</label>
          <input class="form-control" id="product-stock" type="number" step="1" min="0" placeholder="10">
        </div>
        <div class="col-md-12 col-lg-2 d-grid">
          <button class="btn btn-primary" id="submit-btn" type="button">保存并同步</button>
        </div>
      </div>
      <div class="form-text mt-2">
        写入指定数据库后，触发器会把变更写入 <code>change_log</code>，worker 再按“实时/定时”配置同步到其他实例。
      </div>
    </div>
  </div>

  <div class="card card-dashboard">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h3 class="h6 mb-0">当前库最新商品</h3>
        <span class="badge text-bg-light" id="table-meta"></span>
      </div>
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>#</th>
              <th>名称</th>
              <th>价格</th>
              <th>库存</th>
              <th>版本 / 来源库</th>
              <th>更新时间</th>
            </tr>
          </thead>
          <tbody id="data-table">
            <tr>
              <td colspan="6" class="text-muted text-center">请选择数据库后自动加载。</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="small text-muted mt-2">
        提示：商品、订单与明细均已建立主键/索引，并通过多库触发器记录 <code>row_version</code> 与 <code>updated_by_db</code>，便于冲突定位。
      </div>
    </div>
  </div>

  <div id="data-status" class="alert mt-3 d-none"></div>
{% endblock %}
{% block scripts %}
  <script src="/static/js/data.js"></script>
{% endblock %}
